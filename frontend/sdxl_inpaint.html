<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>SDXL Inpaint</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <div class="app">
        <header class="header">
            <h1>Synthia Engine</h1>
            <nav class="header-nav">
                <a class="secondary nav-link" href="sdxl.html">SDXL Text2Img</a>
                <a class="secondary nav-link" href="sdxl_img2img.html">SDXL Img2Img</a>
                <a class="secondary nav-link" href="sdxl_inpaint.html">SDXL Inpaint</a>
                <a class="secondary nav-link" href="index.html">SD 1.5</a>
                <a class="secondary nav-link" href="history.html">History</a>
            </nav>
        </header>

        <div class="layout">
            <section class="controls">
                <label class="field">
                    <span>Model</span>
                    <select id="model_select">
                        <option value="" disabled selected>Loading models...</option>
                    </select>
                </label>

                <label class="field">
                    <span>Prompt</span>
                    <textarea id="prompt" placeholder="Enter prompt..."></textarea>
                </label>

                <label class="field">
                    <span>Negative Prompt</span>
                    <textarea id="negative_prompt" class="textarea-small" placeholder="Optional negative prompt..."></textarea>
                </label>

                <label class="field">
                    <span>Initial Image</span>
                    <input id="initial_image" type="file" accept="image/*" />
                </label>

                <div class="mask-preview-tab">
                    <button class="secondary" type="button" onclick="toggleMaskPreview()">Mask preview</button>
                    <div id="mask_preview_panel" class="mask-preview-panel hidden">
                        <div class="mask-preview-header">
                            <span>Mask details</span>
                            <button class="secondary" type="button" onclick="toggleMaskPreview()">Hide</button>
                        </div>
                        <img id="mask_preview" class="mask-preview" alt="Mask preview" />
                        <div class="field-hint">White = repaint, Black = keep</div>
                        <div class="field-row">
                            <button class="secondary" type="button" onclick="openMaskEditor()">Edit mask</button>
                            <button class="secondary" type="button" onclick="clearMask()">Clear mask</button>
                        </div>
                        <div class="field-row">
                            <button id="mask_blur" class="secondary" type="button" onclick="generateBlurMask()" disabled>Blur mask edges</button>
                            <label class="field inline-field">
                                <span>Blur strength</span>
                                <input id="blur_factor" type="number" min="0" max="128" step="1" value="8" />
                            </label>
                        </div>
                        <div class="field-hint">Higher values soften mask edges (0 - 128).</div>
                        <label class="field inline-field">
                            <input id="blur_toggle" type="checkbox" disabled />
                            <span>Preview blurred mask</span>
                        </label>
                    </div>
                </div>

                <label class="field">
                    <span>Padding Mask Crop</span>
                    <input id="padding_mask_crop" type="number" value="32" min="0" max="500" step="1" />
                </label>

                <div class="field-row">
                    <label class="field">
                        <span>Seed</span>
                        <input id="seed" type="number" value="0" step="1" />
                    </label>
                    <label class="field">
                        <span>Steps</span>
                        <input id="steps" type="number" value="30" step="1" />
                    </label>
                </div>

                <label class="field">
                    <span>Guidance Scale</span>
                    <input id="guidance_scale" type="number" step="0.5" value="7.5" />
                </label>

                <label class="field">
                    <span>Strength</span>
                    <input id="strength" type="number" value="0.5" min="0" max="1" step="0.1" />
                </label>

                <label class="field">
                    <span>Clip Skip</span>
                    <input id="clip_skip" type="number" value="1" min="0" max="8" />
                </label>

                <label class="field">
                    <span>Images</span>
                    <input id="num_images" type="number" value="1" min="1" max="8" />
                </label>

                <button class="primary" onclick="generateSdxlInpaint()">Generate</button>
            </section>

            <section class="gallery-panel">
                <div class="gallery-header">
                    <h2>SDXL Inpaint Gallery</h2>
                    <p>Outputs appear here as they render.</p>
                </div>
                <div class="viewer">
                    <div class="viewer-frame">
                        <div id="viewer-empty" class="viewer-empty">No images yet</div>
                        <img id="viewer-image" alt="Generated output" />
                    </div>
                    <div class="viewer-controls">
                        <button id="viewer-prev" class="secondary" type="button">Prev</button>
                        <span id="viewer-count">0 / 0</span>
                        <button id="viewer-next" class="secondary" type="button">Next</button>
                    </div>
                    <div id="viewer-thumbs" class="viewer-thumbs"></div>
                </div>
            </section>
        </div>
    </div>

    <div id="mask_modal" class="modal hidden" role="dialog" aria-modal="true">
        <div class="modal-content">
            <header class="modal-header">
                <h2>Mask Editor</h2>
                <button class="secondary" type="button" onclick="closeMaskEditor()">Close</button>
            </header>
            <p class="modal-subtitle">Paint white to inpaint. Black keeps the original image.</p>
            <div class="modal-toolbar">
                <label class="field">
                    <span>Brush Size</span>
                    <input id="brush_size" type="range" min="5" max="120" value="35" />
                    <div class="field-hint">Size: <span id="brush_value">35</span>px</div>
                </label>
                <label class="field">
                    <span>Zoom</span>
                    <input id="zoom_level" type="range" min="25" max="200" value="100" />
                    <div class="field-hint">Zoom: <span id="zoom_value">100</span>%</div>
                </label>
                <label class="field inline-field">
                    <input id="erase_toggle" type="checkbox" />
                    <span>Erase mode (paint black)</span>
                </label>
                <button class="secondary" type="button" onclick="clearMask()">Clear mask</button>
                <button class="primary" type="button" onclick="saveMask()">Save mask</button>
            </div>
            <div class="mask-editor">
                <div class="canvas-stack">
                    <div class="canvas-scroll">
                        <canvas id="base_canvas" class="mask-canvas"></canvas>
                        <canvas id="mask_canvas" class="mask-canvas"></canvas>
                    </div>
                </div>
                <div class="field-hint" id="image_info">Upload an image to start masking.</div>
            </div>
        </div>
    </div>

    <script src="gallery.js?v=1"></script>
    <script src="sdxl_inpaint.js?v=1"></script>
</body>

</html>
